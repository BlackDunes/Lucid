/*
	jQuery progress wheel copyright 2012 Robert Rook
	Released under the terms of the ABD Free Source Code Licence
	www.advancebydesign.com
*/
function pctToRad(a){return a*3.6*Math.PI/180}function pw_init(a){a.data({scrolldelay:30,cval:0,destval:0,fill:0});pw_updateArcs[pw_updateArcs.length]={ref:a,interval:0};pw_redraw(a)}function pw_createIn(a,b,c,d){if(!a||!a.append)return false;if((isNaN(b)||b<1)&&(isNaN(c)||c<1)){b=100;c=100}else if(isNaN(b)||b<1){b=c}else if(isNaN(c)||c<1){c=b}a.append('<canvas width="'+b+'px" height="'+c+'px" class="progresswheel"></canvas>');a.children(".progresswheel").last().css({width:b,height:c});pw_init(a.children(".progresswheel").last());pw_setCallback(a.children(".progresswheel").last(),d);return a.children(".progresswheel").last()}function pw_fillSolid(a){return{fill:"solid",c:a}}function pw_fillRadial(a){return{fill:"radial",c:a}}function pw_fillImage(a,b,c){b=isNaN(b)?100:b;c=isNaN(c)?100:c;return{fill:"image",c:{url:a,w:b,h:c}}}function pw_redraw(a){v=a.data("cval");if(pw_canvasSupport){ctx=a[0].getContext("2d");centreX=a.width()/2;centreY=a.height()/2;fill="#000000";fillImage=0;f=a.data("fill");if(typeof f=="object"&&typeof f.fill!="undefined"&&typeof f.c!="undefined"){if(f.fill=="solid")fill=f.c;else if(f.fill=="radial"&&typeof f.c=="object"){fill=ctx.createRadialGradient(centreX,centreY,0,centreX,centreY,centreX);for(x in f.c){if(isNaN(parseFloat(x))||x<0||x>1)continue;fill.addColorStop(parseFloat(x),f.c[x])}}else if(f.fill=="image"&&typeof a.data("fillImage")!="undefined"&&a.data("fillImage").complete){fillImage=1}}ctx.clearRect(0,0,a.width(),a.height());ctx.save();ctx.fillStyle=fill;ctx.beginPath();ctx.moveTo(centreX,centreY);ctx.arc(centreX,centreY,centreX,pctToRad(-25),pctToRad(-25+v),false);ctx.lineTo(centreX,centreY);if(fillImage){ctx.closePath();ctx.clip();ctx.drawImage(a.data("fillImage"),centreX-f.c.w/2,centreY-f.c.h/2,f.c.w,f.c.h)}else{ctx.fill()}ctx.restore()}else{if(!a.next("span.progresswheellabel").length){a.after('<span class="progresswheellabel">'+v+"%</span>");a.next("span.progresswheellabel").css({position:"absolute","z-index":999})}d=a.next("span.progresswheellabel");d.html(v+"%");offset=a.offset();d.css({left:offset.left+a.width()/2-d.width()/2,top:offset.top+a.height()/2-d.height()/2})}if(v==100&&a.data("callback")&&typeof a.data("callback")=="function")a.data("callback")()}function pw_setUpdateMS(a,b){if(typeof a=="undefined"||!a.hasClass||!a.hasClass("progresswheel"))return false;if(isNaN(parseInt(b))||b<=0||b>=1e4)return false;a.data("scrolldelay",b)}function pw_setFill(a,b){if(typeof a=="undefined"||!a.hasClass||!a.hasClass("progresswheel"))return false;if(b.fill&&b.fill=="image"&&b.c&&b.c.url){a.data("fillImage",new Image);a.data("fillImage").src=b.c.url}a.data("fill",b);pw_redraw(a)}function pw_setCallback(a,b){if(typeof b!="function")return false;if(typeof a=="undefined"||!a.hasClass||!a.hasClass("progresswheel"))return false;a.data("callback",b)}function pw_scrollToVal(a,b){if(isNaN(b)||b<0||b>100)return false;if(typeof a=="undefined"||!a.hasClass||!a.hasClass("progresswheel"))return false;idx=-1;for(x in pw_updateArcs){if(pw_updateArcs[x].ref==a||pw_updateArcs[x].ref[0]==a[0]){if(pw_updateArcs[x].interval){window.clearInterval(pw_updateArcs[x].interval)}idx=x;break}}if(idx==-1)return;a.data({destval:b});pw_updateArcs[idx].interval=window.setInterval("pw_scroll("+idx+");",a.data("scrolldelay"))}function pw_scroll(a){if(typeof pw_updateArcs[a]=="undefined"){if(pw_updateArcs[a].interval)window.clearInterval(pw_updateArcs[a].interval);return}d=pw_updateArcs[a].ref.data("destval");v=pw_updateArcs[a].ref.data("cval");if(d<v)v--;else if(d>v)v++;pw_updateArcs[a].ref.data("cval",v);if(d==v)window.clearInterval(pw_updateArcs[a].interval);pw_redraw(pw_updateArcs[a].ref)}function pw_setVal(a,b){if(isNaN(b)||b<0||b>100)return false;if(typeof a=="undefined"||!a.hasClass||!a.hasClass("progresswheel"))return false;for(x in pw_updateArcs){if(pw_updateArcs[x].ref==a||pw_updateArcs[x].ref[0]==a[0]){if(pw_updateArcs[x].interval){window.clearInterval(pw_updateArcs[x].interval)}break}}a.data({cval:b,destval:b});pw_redraw(a)}function pw_getVal(a){if(typeof a=="undefined"||!a.hasClass||!a.hasClass("progresswheel"))return false;return a.data("cval")}var pw_updateArcs=new Array;var pw_canvasSupport=0;$(function(){$(".progresswheel").each(function(){pw_init($(this))});var a=document.createElement("canvas");if(a.getContext&&a.getContext("2d"))pw_canvasSupport=1})